= 元素属性

元素属性是控制 AsciiDoc 中各种块和内联元素的内置设置的有效手段，还可用于向某些元素添加补充信息。

元素属性用于定义某个块元素或内联元素（包括宏）的内置设置和用户自定义的设置以及元数据，虽然 `include` 指令从技术上说不是元素，但是也可以在 `include` 指令上定义元素属性。

元素属性可以是未知属性或具名属性（键值对），一些内置属性和扩展属性会将未知属性映射到具名属性。
每个元素都会识别一组预定义的位置和具名元素属性，除此之外，我们还可以定义任意数量的自定义元素属性。

所有的块元素跟多数的内联元素共享一组核心的保留属性，包括 `id`，`role`，`opts` 和 `title`。某些元素可能有额外的保留属性，如，
源码块保留 `lang` 属性用于设置源码语言，保留 `linenums` 属性用于启用行号。

元素属性通常有以下用途：

* 声明元素的 ID
* 打开或关闭某个元素的内置功能
* 配置单个元素的内置功能
* 给单个元素定义一些额外信息
* 给单个元素定义一些角色或行为

== 定义元素属性

元素属性的定义跟文档属性不同，是直接将属性列在一对中括号中，多个元素间以逗号分隔，这种形式称为属性列表。

属性列表中的条目用逗号分隔，但引号内的逗号不是属性分隔符。属性列表条目使用的语法决定了它是位置属性还是具名属性。
条目分隔符（逗号）后面的空格是可选的。

对于块元素，属性列表放置在一个或多个块属性行内，块属性行是位于块开头上方（起始分隔符或内容）的任意一行文本，以 `[` 开头并以 `]` 结尾。

块属性行：

[,asciidoc]
----
[style,second-positional,named="value of named"]
----

对于块宏和内联宏，属性列表放在宏的方括号之间。块宏的属性列表中的文本永远不需要转义，但内联宏的属性列表中的文本可能需要转义，以避免宏过早结束或发生替换。

带有属性列表的块宏：

[,asciidoc]
----
name::target[first-positional,second-positional,named="value of named"]
----

对于格式化文本，属性列表放在文本前面的方括号中，格式化文本只支持受限的属性列表，不支持具名属性。

带有属性列表的格式化文本：

[,asciidoc]
----
[#idname.rolename]*text with id and role*
----

属性列表有如下特性：

* 应用于块、宏和内联宏
* 可以包含位置和具名属性
* 如果元素支持覆盖，则属性列表中的属性优先级比文档属性高

== 位置属性和具名属性

元素上的属性分为位置属性和具名属性。

=== 位置属性

属性列表中仅由值组成的条目称为位置属性，位置属性从索引 1 开始。

如果块或宏为位置属性定义了隐式的属性名映射，则我们还可以使用隐式属性名称来为位置属性分配值。

以下是一些映射示例：

* `icon` 1 => size
* `image:` 和 `image::` 1 => alt(text), 2 => width, 3 => height
* 分隔块 1 => 块样式和属性简写
* 其它内联引用文本 1 => 属性简写
* `link:` 和 `xref` 1 => 文本
* 自定义块和宏也可指定位置属性

下面两个图像宏是等效的：

[,asciidoc]
----
image::sunset.jpg[Sunset,300,400]

image::sunset.jpg[alt=Sunset,width=300,height=400]
----

=== 块样式和属性简写

属性简写是为了减少字符输入，让我们不必用具名属性这种全写形式，而是将属性值以特殊标记作为前缀将其压缩到一起。

特殊标记有如下几种：

* `#` - ID
* `.` - 角色（role）
* `%` - 选项（option）

每个简写的属性值都与前一个相邻，顺序无关紧要，但样式除外，它必须被放在最前面。

所有块上的第一个位置属性都是特殊的，它用于定义块样式，还支持同时定义 ID，角色和选项属性的简写语法。

下面通过简写形式设置一个章节的 ID：

[,asciidoc]
----
[#custom-id]
== Section with Custom ID
----

如果需要显式地指定样式，则样式必须位于最前面：

[,asciidoc]
----
[appendix#custom-id]
== Appendix with Custom ID
----

下面是同时设置 ID（`rules`），角色（`prominent`）和选项（`incremental`）的示例：

[,asciidoc]
----
[#rules.prominent%incremental]
* Work hard
* Play hard
* Be happy
----

一个块可以有多个角色和选项，但是 ID 只能有一个。下面在一个表格中通过简写语法设置了三个选项（`header`, `footer` 和 `autowidth`）：

[,asciidoc]
----
[%header%footer%autowidth]
|===
|Header A |Header B
|Footer A |Footer B
|===
----

=== 格式化文本的属性简写

格式化文本中也支持属性简写语法，但是格式化文本不支持指定样式。

下面用属性简写形式给格式化文本设置了 ID 和角色：

[,asciidoc]
----
[#free-world.goals]*free the world*
----

=== 具名属性

具名属性由名称和值组成，并用 `=` 字符分隔（如：`name=value`）。

如果值包含空格、逗号或引号，则必须使用双引号或单引号括起来，否则，引号是可选的。
如果值中包含的引号跟括住值的引号字符相同，则必须对值中的引号用反斜杠转义（如：`value="the song\"Dark Horse\""`）。

要将一个具名属性取消设置，只需将值设置为 `None`（大小写敏感）。

== 属性列表解析

用于定义元素属性的源文本称为 `attrlist`，`attrlist` 始终包含在一堆方括号中，这适用于块或宏上的属性。
处理器会将 `attrlist` 拆分为独立的属性条目，并确定它们是位置属性还是具名属性，然后解析条目并将结果作为对应节点的属性。

确定单个属性边界以及是位置属性还是具名属性的流程如下：

* 在解析 `attrlist` 之前，属性引用会被扩展。
* 解析属性从属性列表字符串的开头或前面的分隔符（`,`）之后进行。
** 属性列表的第一个字符不能是制表符或空格，对于后续属性，会跳过任何前导空格或制表符。
* 如果找到有效的属性名称，且其后跟着等号（`=`），则解析器将其识别为具名属性，等号之后直到找到下一个逗号或列表末尾的文本将被视为属性值。等号周围和值末尾的空格和制表符将被忽略。
* 否则，条目被识别为位置属性，其值在下一个分隔符或列表末尾结束，值边界处的任何空格或制表符都被忽略。
* 解析属性值：
** 如果第一个字符不是引号，则读取字符串直到下一个分隔符或字符串结尾。
** 如果第一个字符是双引号，则读取字符到下一个未转义的双引号；如果没有闭合的双引号，则读取到下一个分隔符。
** 如果下一个字符是单引号（`'`），则读取字符直到下一个未转义的单引号，如果没有闭合的单引号，则读取到下一个分隔符。

[NOTE]
====
因为 attrlist 的终止符是右方括号，所以如果右方括号出现在属性值中，有时需要对其进行转义。
在面向行的语法中（如：块属性列表、块宏或包含指令），不需要转义出现在属性列表值中的右方括号，因为解析器知道在行末查找闭合的右方括号。
如果内联元素（如：内联宏）的 attrlist 中出现右方括号，通常必须使用反斜杠或字符引用 `&#93;` 进行转义。
====
